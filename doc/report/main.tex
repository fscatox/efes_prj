\documentclass[]{article}

%% Minted work-around
\usepackage[section, outputdir=build]{minted}
\input{packages}

%%
%% User data
%%

\newcommand{\Id}{01NWMOQ \xspace}
\newcommand{\Course}{Electronics for Embedded Systems}
\newcommand{\Date}{\today}
\newcommand{\Title}{Experimental Project}
\newcommand{\Authors}{Fabio Scatozza (315216)}

%%
%% Page data
%%

\geometry{
  a4paper,
  top=2.54cm,bottom=2.54cm,left=2.54cm,right=2.54cm,
  headheight=25pt,
  heightrounded,includeheadfoot}
\pagestyle{fancyplain}
\lhead{\Id - \Course \\ \Title}
\rhead{}
\cfoot{}
\rfoot{\thepage/\pageref{LastPage}}
\renewcommand{\footrulewidth}{0.4pt}

%%
%% Hyperref & biblio
%%
\usepackage[autostyle,italian=guillemets]{csquotes}
\usepackage[style=numeric-comp,backend=biber]{biblatex}
\addbibresource{ref.bib}
\nocite{*}

\usepackage[nolist]{acronym}
\usepackage{hyperref, cleveref}
\hypersetup{
  colorlinks=false,
  pdfstartpage=1, pdfstartview=FitV, pdfborder={0 0 0},
  breaklinks=true, pageanchor=true,
  pdftitle={(\Id) \Title},
  pdfauthor={},
  pdfcreator={pdfLaTeX},
  pdfproducer={LaTeX with hyperref}
}

\title{\textbf{\Course}\\\Title}
\author{\Authors}
\date{\Date}

%%
%% Custom macros
%%

\input{macros}

\begin{document}
\input{acronyms}
\maketitle
\tableofcontents
\vfill
\printbibliography
\clearpage

\section{Introduction}

The \emph{Electronics for Embedded Systems} course explores the analog and digital aspects of embedded system design, focusing on the key components of their typical architecture. While sensor and actuator specifics are addressed in other courses, this course emphasizes the interface between the analog and digital domains, particularly A/D and D/A conversion, as well as the power electronics of actuator drivers and power supply devices. In the digital domain, the course spans software implementations running on microprocessors to hardware synthesized on programmable devices, with an emphasis on the underlying technology enabling computation, communication, and storage. Specifically, this involves analyzing the theory of programmable logic devices, microprocessor embedded peripherals, wired communication protocols, and memories.

In this context, the document presents a small-scale project aimed at addressing the key topics of the course, demonstrating competency aligned with the expected learning outcomes.

\section{Theory of Operation}\label{sec:theory_operation}

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{../gfx/system_diagram.eps}
    \caption{System block diagram}
    \label{fig:sys}
\end{figure}

The system implements an interface to program the movement pattern for a bipolar stepper motor and execute it on demand. The pattern is committed to non-volatile storage and consists of a sequence of data points, each representing a circular motion segment defined by angular velocity and displacement. During execution, the data points are retrieved in a circular fashion from memory, and are converted into motor-driving stimuli.
Referring to the system block diagram in~\cref{fig:sys}, the interface is operated as follows.
\begin{itemize}
    \item The movement pattern is cleared by pressing and holding the user push button for at least \qty{1}{\s}. Successful clearing is acknowledged by displaying \emph{CLEAr} on the 7-segment displays.
    
    \item Data points are entered using the linear potentiometer and the PS/2 keyboard. The potentiometer sets the angular velocity in the range from \qtyrange{2.5}{400}{\rpm}, while the angular displacement is specified in degrees with the keyboard, according to the following regex pattern.
    \begin{center}
    \begin{BVerbatim}
    [+-]?[0-9]{1,3}(\.[0-9])?
    \end{BVerbatim}
    \end{center}
    The sign defaults to \verb|+| if omitted, which corresponds to a counterclockwise rotation. The integer part is specified with up to three digits, whereas the fractional part is optionally specified with one digit.
    Due to the inherently discrete nature of the stepper motor rotation and accounting for the two-phases-on driving method, the target angular displacement is rounded to the nearest value that minimizes error.

    When the data point entry begins, triggered by pressing some keys, the 7-segment displays change to \emph{InPUt}. The operation is terminated by pressing the return \keys{\return} or \keys{\enter} keys, upon which data is validated, and the potentiometer output is converted. The outcome is notified as follows: \emph{Err-2 bAd PAttErn}, if the parsing of the keyboard input failed; \emph{Err-3 FuLL}, if the maximum number of data points have already been entered. Otherwise, if no error has occurred, the data point is displayed in the format below, where the data point number starts at zero, the angular velocity is expressed in revolutions per minute, and the angular displacement in degrees.
    \begin{center}
    \begin{BVerbatim}
    [<data point number>] <angular velocity> <angular displacement>
    \end{BVerbatim}
    \end{center}

    \item The execution of a valid movement pattern, that is, one containing at least one data point, begins by pressing the user push button. An empty pattern results in the display of \emph{Err-1 no dAtA}, while a valid pattern displays \emph{PLAy}. The execution continues until the push button is pressed again, after which the displays revert to printing \emph{IdLE}.
\end{itemize}

\input{system_design}

\input{software_design}

\clearpage
\appendix

\section{PS/2 Controller}\label{apx:ps2_controller}

\rotatebox{90}{
    \begin{minipage}{.85\textheight}
        \includegraphics[width=\textwidth]{../gfx/ps2_asm.eps}
        \captionof{figure}{PS/2 controller detailed ASM chart}
        \label{fig:ps2_asm}
    \end{minipage}
}

\rotatebox{90}{
    \begin{minipage}{.85\textheight}
        \includegraphics[width=\linewidth]{../gfx/ps2_dp.eps}
        \captionof{figure}{PS/2 controller data path}
        \label{fig:ps2_dp} 
    \end{minipage}
}

\clearpage
\section{Show-Ahead Single-Clock FIFO}\label{apx:fifo}

\begin{center}
    \includegraphics[width=.7\linewidth]{../gfx/fifo.eps}
    \captionof{figure}{Show-ahead single-clock FIFO design}
    \label{fig:fifo}
\end{center}

\section{SPI Slave Controller}\label{apx:spi}

\begin{figure}[h!]
    \centering
    \includegraphics[width=\linewidth]{../gfx/spi_slave.eps}
    \caption{SPI slave controller}
    \label{fig:spi_slave}
\end{figure}

\begin{figure}[h!]
    \centering
    \subfloat[][\qty{4}{\bit} transmission, CPOL = 0, CPHA = 0]{
        \includegraphics[width=.8\linewidth]{../gfx/spi_timing_cpha0.eps}
    }\\
    \subfloat[][\qty{4}{\bit} transmission, CPOL = 0, CPHA = 1]{
        \includegraphics[width=.8\linewidth]{../gfx/spi_timing_cpha1.eps}
    }
    \caption{Manual timing analysis for the SPI slave controller}
    \label{fig:spi_timing}
\end{figure}

\clearpage
\section{UAR(T) Core}\label{apx:uart}

\begin{figure}[h!]
    \centering
    \subfloat[][Datapath]{
        \includegraphics[width=\linewidth]{../gfx/uart_rx_dp.eps}
    }\\
    \subfloat[][ASM detailed chart]{
        \includegraphics[width=.45\linewidth]{../gfx/uart_rx_asm.eps}
    }
    \caption{UART receiver-only core design}
    \label{fig:uart}
\end{figure}

\end{document}
